(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{7016:(e,t,r)=>{Promise.resolve().then(r.bind(r,9939))},8800:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>i,_:()=>d});var n=r(5155),s=r(2115),a=r(3568);let l=(0,s.createContext)(),c=(e,t)=>{switch(t.type){case"INIT_CART":return t.payload||[];case"ADD_TO_CART":{let r=e.find(e=>e.id===t.product.id&&e.selectedOption===t.product.selectedOption);if(r){if(r.quantity>=10)return e;return e.map(e=>e.id===t.product.id&&e.selectedOption===t.product.selectedOption?{...e,quantity:Math.min(e.quantity+1,10)}:e)}return[...e,{...t.product,quantity:1}]}case"REMOVE_FROM_CART":return e.filter(e=>e.id!==t.id||e.selectedOption!==t.option);case"INCREMENT_QUANTITY":return e.map(e=>e.id===t.id&&e.selectedOption===t.option?e.quantity>=10?e:{...e,quantity:Math.min(e.quantity+1,10)}:e);case"DECREMENT_QUANTITY":return e.map(e=>e.id===t.id&&e.selectedOption===t.option?{...e,quantity:Math.max(1,e.quantity-1)}:e);case"CLEAR_CART":return[];default:return e}},i=e=>{let{children:t}=e,[r,i]=(0,s.useReducer)(c,[]),d=(0,s.useRef)(!1),o=(0,s.useRef)(null),u=(0,s.useRef)([]);(0,s.useEffect)(()=>{let e=localStorage.getItem("cart");if(e)try{let t=JSON.parse(e);i({type:"INIT_CART",payload:t}),u.current=t}catch(e){localStorage.removeItem("cart")}},[]),(0,s.useEffect)(()=>{JSON.stringify(u.current)!==JSON.stringify(r)&&(r.length>0?localStorage.setItem("cart",JSON.stringify(r)):localStorage.removeItem("cart"),u.current=r)},[r]),(0,s.useEffect)(()=>()=>{o.current&&clearTimeout(o.current)},[]);let m=(0,s.useCallback)(e=>{let t=r.find(t=>t.id===e.id&&t.selectedOption===e.selectedOption);if((null==t?void 0:t.quantity)>=10){d.current||(a.oR.error("Нельзя добавить больше 10 штук этого букета в корзину"),d.current=!0,o.current=setTimeout(()=>{d.current=!1},3e3));return}i({type:"ADD_TO_CART",product:e})},[r]),p=(0,s.useCallback)((e,t)=>{let n=r.find(r=>r.id===e&&r.selectedOption===t);if((null==n?void 0:n.quantity)>=10){d.current||(a.oR.error("Максимум 10 штук одного букета"),d.current=!0,o.current=setTimeout(()=>{d.current=!1},3e3));return}i({type:"INCREMENT_QUANTITY",id:e,option:t})},[r]),h=(0,s.useCallback)((e,t)=>{i({type:"REMOVE_FROM_CART",id:e,option:t}),d.current=!1},[]),x=(0,s.useCallback)((e,t)=>{i({type:"DECREMENT_QUANTITY",id:e,option:t}),d.current=!1},[]),f=(0,s.useCallback)(()=>{i({type:"CLEAR_CART"}),d.current=!1},[]);return(0,n.jsx)(l.Provider,{value:{cart:r,addToCart:m,removeFromCart:h,increaseQuantity:p,decreaseQuantity:x,clearCart:f},children:t})},d=()=>(0,s.useContext)(l)},9939:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(5155),s=r(2115),a=r(8800),l=r(2177),c=r(221),i=r(5594),d=r(6766),o=r(6874);r(5279);var u=r(4239),m=r(9223);r(3568),(0,u.E)("ru",m.A);let p=i.z.object({senderName:i.z.string().min(1,"Имя отправителя обязательно"),senderEmail:i.z.string().email("Некорректный E-mail"),senderPhone:i.z.string().optional(),contactMethod:i.z.string().min(1,"Выберите способ связи, ТГ, ВК, телефон"),deliveryDate:i.z.string().optional(),deliveryTime:i.z.string().optional(),deliveryMethod:i.z.string().min(1,"Выберите способ доставки"),recipientAddress:i.z.string().optional(),comment:i.z.string().optional(),promoCode:i.z.string().optional(),paymentMethod:i.z.string().optional(),agreeTerms:i.z.boolean().refine(e=>!0===e,"Вы должны согласиться с условиями")}),h=()=>{let{cart:e,removeFromCart:t,clearCart:r,increaseQuantity:i,decreaseQuantity:u}=(0,a._)(),[m,h]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[b,g]=(0,s.useState)(new Date),[j,y]=(0,s.useState)(""),[N,v]=(0,s.useState)(!1),[E,T]=(0,s.useState)(!1),[C,w]=(0,s.useState)(0),[O,_]=(0,s.useState)(!1),[R,M]=(0,s.useState)(""),[S,k]=(0,s.useState)(""),{register:A,handleSubmit:D,formState:{errors:q},reset:I,setValue:z}=(0,l.mN)({resolver:(0,c.u)(p)});(0,s.useEffect)(()=>{z("deliveryDate",b.toLocaleDateString("ru-RU"))},[b,z]),(0,s.useEffect)(()=>{z("deliveryTime",j)},[j,z]),(0,s.useEffect)(()=>{console.log("Ошибки формы:",q)},[q]);let P=e.reduce((e,t)=>e+parseFloat(String(t.price).replace(" ₽","").replace(" ",""))*(t.quantity||1),0),F=()=>{f(!1),_(!1),M("")},J=D(async t=>{if(0===e.length){alert("Корзина пуста");return}T(!0);try{if(!O){let e=Math.floor(1e3+9e3*Math.random()).toString(),t="https://t.me/BerryShopAuthBot?start=".concat(C,"_").concat(e);window.open(t,"_blank"),k(e),_(!0);return}if(R!==S)throw Error("Неверный код подтверждения");await L(t),h(!0),r(),I(),F()}catch(e){alert("Ошибка: ".concat(e.message))}finally{T(!1)}});async function L(t){try{let r="<b>\uD83D\uDCE6 Новый заказ!</b>\n\n";r+="<b>\uD83D\uDC64 Отправитель:</b>\n",r+="- Имя: ".concat(t.senderName,"\n"),r+="- Email: ".concat(t.senderEmail,"\n"),r+="- Способ связи: ".concat(t.contactMethod,"\n\n"),r+="- Способ доставки: ".concat(t.deliveryMethod,"\n\n"),r+="<b>\uD83D\uDED2 Товары:</b>\n",e.forEach((e,t)=>{r+="".concat(t+1,". ").concat(e.name," (").concat(e.selectedOption,") - ").concat(e.quantity," \xd7 ").concat(e.price,"\n")}),r+="\n<b>\uD83D\uDCB0 Итого: ".concat(P," ₽</b>");let n=await fetch("https://api.telegram.org/bot7969947917:AAGPqZxT7FxAmbR4HA8ntRVPTh0seL51law/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:"581497267",text:r,parse_mode:"HTML"})}),s=await n.json();if(alert("Спасибо за заказ, скоро с вами свяжется менеджер"),!n.ok)throw console.error("Ошибка Telegram API:",s),Error("Ошибка отправки сообщения");return console.log("Сообщение успешно отправлено:",s),!0}catch(e){return console.error("Ошибка при отправке данных:",e),!1}}return(0,n.jsxs)("div",{className:"container mx-auto p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Корзина"}),0===e.length?(0,n.jsxs)("p",{children:["Корзина пуста."," ",(0,n.jsx)(o,{href:"/",className:"text-blue-500",children:"Вернуться к покупкам"})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("ul",{children:e.map((e,r)=>(0,n.jsxs)("li",{className:"flex justify-between items-center py-4 border-b",children:[(0,n.jsx)("div",{className:"flex items-center flex-wrap",children:(0,n.jsx)(d.default,{src:e.image,alt:e.name,width:150,height:250,className:"object-cover mx-auto rounded-md"})}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-between gap-2 ml-5 w-full",children:[(0,n.jsxs)("div",{className:"ml-5",children:[(0,n.jsx)("p",{className:"font-semibold",children:e.name}),(0,n.jsx)("p",{className:"text-sm",children:e.price}),(0,n.jsx)("p",{className:"text-sm",children:e.selectedOption})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{onClick:()=>u(e.id,e.selectedOption),className:"px-2 py-1 m-4 bg-gray-200 rounded",children:"-"}),(0,n.jsx)("span",{children:e.quantity}),(0,n.jsx)("button",{onClick:()=>i(e.id,e.selectedOption),className:"px-2 m-4 py-1 bg-gray-200 rounded",children:"+"}),(0,n.jsx)("button",{onClick:()=>t(e.id,e.selectedOption),className:"text-red-500 ml-4",children:"Удалить"})]})]})]},"".concat(e.id,"-").concat(e.selectedOption,"-").concat(r)))}),(0,n.jsxs)("p",{className:"font-semibold",children:["Итоговая сумма: ",P," ₽"]}),(0,n.jsxs)("div",{className:"mt-6 flex justify-between items-center",children:[(0,n.jsx)("button",{onClick:r,className:"bg-red-500 text-white py-2 px-4 rounded-md",children:"Очистить корзину"}),(0,n.jsx)("button",{onClick:()=>f(!0),className:"bg-green-500 text-white py-2 px-4 rounded-md",children:"Оформить заказ"})]})]}),x&&(0,n.jsx)("div",{onClick:e=>{e.target===e.currentTarget&&F()},className:"fixed inset-0 flex items-center justify-center z-50 bg-opacity-50 backdrop-blur-sm",children:(0,n.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"bg-white p-8 rounded-md w-full max-w-lg relative max-h-[90vh] overflow-y-auto border-black border-1",children:[(0,n.jsx)("button",{className:"absolute top-4 right-4 text-xl font-bold text-gray-500",onClick:F,children:"\xd7"}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6",children:O?"Подтверждение телефона":"Оформление заказа"}),(0,n.jsxs)("form",{onSubmit:J,className:"space-y-4",children:[O?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Введите код подтверждения"}),(0,n.jsx)("input",{type:"number",value:R,onChange:e=>M(e.target.value),placeholder:"Код из Telegram",className:"w-full p-2 border rounded-md"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Проверьте Telegram для получения кода"})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Имя заказчика"}),(0,n.jsx)("input",{...A("senderName"),placeholder:"Имя заказчика",className:"w-full p-2 border rounded-md"}),q.senderName&&(0,n.jsx)("p",{className:"text-red-500",children:q.senderName.message})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"E-mail заказчика"}),(0,n.jsx)("input",{...A("senderEmail"),placeholder:"E-mail",className:"w-full p-2 border rounded-md"}),q.senderEmail&&(0,n.jsx)("p",{className:"text-red-500",children:q.senderEmail.message})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Укажите способ связи(ТГ, ВК, номер телефона)"}),(0,n.jsx)("input",{...A("contactMethod"),placeholder:"@tg / +7(123)456 78-90",className:"w-full p-2 border rounded-md"}),q.contactMethod&&(0,n.jsx)("p",{className:"text-red-500",children:q.contactMethod.message})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Укажите способ доставки"}),(0,n.jsxs)("select",{...A("deliveryMethod"),className:"w-full p-2 border rounded-md",children:[(0,n.jsx)("option",{defaultValue:"puckup",children:"Самовывоз"}),(0,n.jsx)("option",{value:"deliver",children:"Доставка"})]}),q.deliveryMethod&&(0,n.jsx)("p",{className:"text-red-500",children:q.deliveryMethod.message})]})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{...A("agreeTerms"),type:"checkbox",checked:N,onChange:()=>v(!N),className:"form-checkbox"})," Я согласен с условиями*"]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-light",children:"* Принимаем заказы по полной предоплате"}),(0,n.jsx)("p",{className:"font-light",children:"Укажите номер телефона и мессенджер, где будет удобно связаться с вами для подтверждения заказа и его оплаты"}),(0,n.jsx)("p",{className:"font-light",children:"Учитывайте, что срок годности клубники в шоколаде 24ч"})]}),(0,n.jsx)("button",{type:"submit",className:"bg-green-500 text-white py-2 px-4 rounded-md mt-4 disabled:opacity-50",disabled:!N||E,children:O?E?"Проверка...":"Подтвердить заказ":E?"Подготовка...":"Получить код"})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[302,545,579,444,773,874,941,441,684,358],()=>t(7016)),_N_E=e.O()}]);